!function(){"use strict";function loadZekiImports(){const e=document.querySelector('script[src*="ZekiCore"]'),t=e?.getAttribute("import")?.trim();if(t){const n=document.createElement("script");n.async=!1,n.type="text/javascript",n.src=e.attributes.src.value.split("/").fill(t,-1).join("/")+(t.includes(".js")?"":".js"),n.onerror=()=>{console.error(`Failed to load script: ${n.src}`)},document.head.appendChild(n),e.removeAttribute("import")}}function bindEvent(e,t){const n=[frames,location,console,history,document,navigator,screen,window];let r,i;const l=e;for(const t of n){for(const n in t)if(t[n]===e){r=n,i=t;break}if(r&&i)break}r&&i?i[r]={[r]:function(){const e=l.apply(i,arguments),n=new Event(t||r,{bubbles:!0,cancelable:!0});return n.arguments=arguments,window.dispatchEvent(n),e}}[r]:console.warn("ZekiCore.bindEvent: 無法在全域物件中找到傳入的函式")}function renderTemplate(e,t={}){const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),r=/\{\{\s*(.*?)\s*\}\}/g;let i;for(;i=n.nextNode();)if(r.test(i.nodeValue)){let e=!1;const n=i.nodeValue.replace(r,((n,r)=>{let i=r.trim();if(i.includes("|")){const[t,n]=i.split("|").map((e=>e.trim()));i=t,"html"===n&&(e=!0)}try{const e=Object.keys(t),n=Object.values(t);return new Function(...e,`return ${i}`)(...n)}catch(e){return`{{ ${r} }}`}}));if(e){const e=document.createElement("div");e.innerHTML=n,Array.from(e.childNodes).forEach((e=>{i.parentElement.insertBefore(e,i)})),i.parentElement.removeChild(i)}else i.nodeValue=n}return e}async function fetchTemplate(e){const t=await fetch(`template/${e.includes(".html")?e:e+".html"}`),n=await t.text(),r=(new DOMParser).parseFromString(n,"text/html");let i=null,l=null;return i=r.querySelector("template"),i&&(l=i.content.querySelector("script"),l&&l.remove()),l||(l=r.querySelector("script")),{template:i,script:l}}let e=!1;class ZekiFragment{constructor(e){this.el=e,this.elContent=e.content}add(...e){return e=e.map((e=>e instanceof ZekiElement?e.el:e instanceof ZekiCollection?e.map((e=>e.el)):e instanceof HTMLElement?e:(console.warn("ZekiFragment.add: paramN is not ZekiElement or HTMLElement"),null))).filter((e=>null!==e)),this.elContent.append(...e),this}preAdd(...e){return e=e.map((e=>e instanceof ZekiElement?e.el:e instanceof ZekiCollection?e.map((e=>e.el)):e instanceof HTMLElement?e:(console.warn("ZekiFragment.preadd: paramN is not ZekiElement or HTMLElement"),null))).filter((e=>null!==e)),this.elContent.prepend(...e),this}one(e){const t=this.elContent.querySelector(e);return t?new ZekiElement(t):null}all(e){const t=this.elContent.querySelectorAll(e),n=Array.from(t,(e=>new ZekiElement(e)));return new ZekiCollection(n)}moveBefore(e,t){return e instanceof ZekiElement&&(e=e.el),t instanceof ZekiElement&&(t=t.el),this.elContent.moveBefore(e,t),this}replaceKids(...e){return e=e.map((e=>e instanceof ZekiElement?e.el:e instanceof ZekiCollection?e.map((e=>e.el)):e instanceof HTMLElement?e:(console.warn("ZekiFragment.replace: paramN is not ZekiElement or HTMLElement"),null))).filter((e=>null!==e)),this.elContent.replaceChildren(...e),this}getId(e){const t=this.elContent.getElementById(e);return t?new ZekiElement(t):null}get html(){return this.el.innerHTML}set html(e){return this.el.innerHTML=e,this}get kidCount(){return this.elContent.childElementCount}get kids(){const e=this.elContent.children,t=Array.from(e,(e=>new ZekiElement(e)));return new ZekiCollection(t)}get firstKid(){return new ZekiElement(this.elContent.firstElementChild)}get lastKid(){return new ZekiElement(this.elContent.lastElementChild)}}class HashRouter{constructor(e,t){this.el=e,this.outlet=document.getElementById("router-outlet"),this.basePath=location.pathname.slice(0,location.pathname.lastIndexOf("/")),this.pageTitle=document.title,this.init(t)}init(e){zk.log("HashRouter init");const t=this.change.bind(this);window.addEventListener("hashchange",t),this.mapper=e.reduce(((e,t)=>({...e,[t.path]:t})),{}),location.href.split("/").pop()&&!location.href.split("/").pop().includes("index")||(location.href=this.basePath+"/#"),location.hash="/";const n=window.onload;window.onload=async()=>{this.el.querySelectorAll("a[href]").forEach((e=>{e.addEventListener("click",(async t=>{t.preventDefault(),location.hash="/"===e.getAttribute("href").charAt(0)?e.getAttribute("href"):`/${e.getAttribute("href")}`}))})),window.onload=n}}async change(){const e=location.hash,t=e?e.substring(1):"/";zk.log(`hash path: ${t}`);try{const{template:e,script:n}=await fetchTemplate(this.mapper[t].template);if(e){if(window.dispatchEvent(new Event("unmount")),this.outlet.innerHTML=e.innerHTML,n){const e=document.createElement("script");e.type="module",n.src?e.src=n.src:n.innerHTML&&(e.innerHTML=n.innerHTML),this.outlet.appendChild(e)}document.title=""+(this.pageTitle+(t.split("/").pop()?` - ${t.split("/").pop()}`:""))}}catch(e){zk.warn("HashRouter error: ",e),this.outlet.innerHTML="<h1>404 Not Found</h1>",document.title="404 Not Found"}}}class HistoryRouter{constructor(e,t){this.el=e,this.outlet=document.getElementById("router-outlet"),this.basePath=location.pathname.slice(0,location.pathname.lastIndexOf("/")),this.pageTitle=document.title,bindEvent(history.pushState),bindEvent(history.replaceState),this.init(t)}init(e){zk.log("HistoryRouter init");const t=this.change.bind(this);if(window.addEventListener("pushState",t),window.addEventListener("replaceState",t),window.addEventListener("popstate",t),this.mapper=e.reduce(((e,t)=>({...e,[("/"===t.path.charAt(0)?"":"/")+t.path]:t})),{}),sessionStorage.redirect){const e=sessionStorage.redirect;delete sessionStorage.redirect,history.replaceState(null,"",e)}location.pathname.split("/").pop()&&!location.pathname.split("/").pop().includes("index")||history.replaceState(null,"",this.basePath+"/");const n=window.onload;window.onload=async()=>{this.el.querySelectorAll("a[href]").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),history.pushState(null,"",this.basePath+("/"===e.getAttribute("href").charAt(0)?"":"/")+e.getAttribute("href"))}))})),window.onload=n}}async change(){let e=location.pathname;e=e.split(!!this.basePath&&this.basePath).pop(),zk.log(`history path: ${e}`);try{const{template:t,script:n}=await fetchTemplate(this.mapper[e].template);if(t){if(window.dispatchEvent(new Event("unmount")),this.outlet.innerHTML=t.innerHTML,n){const e=document.createElement("script");e.type="module",n.src?e.src=n.src:n.innerHTML&&(e.innerHTML=n.innerHTML),this.outlet.appendChild(e)}document.title=""+(this.pageTitle+(e.split("/").pop()?` - ${e.split("/").pop()}`:""))}}catch(e){zk.warn("HistoryRouter error:",e),this.outlet.innerHTML="<h1>404 Not Found</h1>",document.title="404 Not Found"}}}const t={};Object.defineProperties(t,{one:{value:function one$1(e){const t=document.querySelector(e);return t?new ZekiElement(t):null},enumerable:!0,writable:!1,configurable:!1},all:{value:function all$1(e){const t=document.querySelectorAll(e),n=Array.from(t,(e=>new ZekiElement(e)));return new ZekiCollection(n)},enumerable:!0,writable:!1,configurable:!1},getId:{value:function getId(e){const t=document.getElementById(e);return t?new ZekiElement(t):null},enumerable:!0,writable:!1,configurable:!1},getIds:{value:function getIds(...e){const t=e.map((e=>{const t=document.getElementById(e);return t?new ZekiElement(t):(console.warn(`getIds: ${e} is not exist`),null)})).filter((e=>null!==e));return new ZekiCollection(t)},enumerable:!0,writable:!1,configurable:!1},getTag:{value:function getTag$1(e){const t=document.getElementsByTagName(e),n=Array.from(t,(e=>new ZekiElement(e)));return new ZekiCollection(n)},enumerable:!0,writable:!1,configurable:!1},getClass:{value:function getClass$1(e){const t=document.getElementsByClassName(e),n=Array.from(t,(e=>new ZekiElement(e)));return new ZekiCollection(n)},enumerable:!0,writable:!1,configurable:!1},makeTag:{value:function makeTag(e){return new ZekiElement(document.createElement(e))},enumerable:!0,writable:!1,configurable:!1},makeText:{value:function makeText(e){return document.createTextNode(e)},enumerable:!0,writable:!1,configurable:!1},toZekiEl:{value:function toZekiEl(e){return e instanceof ZekiElement?e:e instanceof Document?new ZekiElement(e.documentElement):e instanceof HTMLElement?new ZekiElement(e):null},enumerable:!0,writable:!1,configurable:!1},importJS:{value:function importJS(e){let t;for(let n=0;n<e.length;n++)t=document.createElement("script"),t.async=!1,t.type="text/javascript",t.src=e[n],t.onerror=()=>{console.error(`Failed to load script: ${t.src}`)},document.head.appendChild(t)},enumerable:!0,writable:!1,configurable:!1},loadZekiImports:{value:loadZekiImports,enumerable:!0,writable:!1,configurable:!1},on:{value:function on$2(e,t,n=!1){if("function"==typeof t)return window.addEventListener(e,t,n),this},enumerable:!0,writable:!1,configurable:!1},off:{value:function off$2(e,t){if("function"==typeof t)return window.removeEventListener(e,t),this},enumerable:!0,writable:!1,configurable:!1},bindEvent:{value:bindEvent,enumerable:!0,writable:!1,configurable:!1},renderTemplate:{value:renderTemplate,enumerable:!0,writable:!1,configurable:!1},setDebug:{value:function setDebug(t){e=t},enumerable:!0,writable:!1,configurable:!1},log:{value:function log(...t){e&&console.log("[ZekiCore Debug]:",...t)},enumerable:!0,writable:!1,configurable:!1},warn:{value:function warn(...t){e&&console.warn("[ZekiCore Warning]:",...t)},enumerable:!0,writable:!1,configurable:!1},error:{value:function error(...t){e&&console.error("[ZekiCore Error]:",...t)},enumerable:!0,writable:!1,configurable:!1},version:{value:"2.2.3",enumerable:!1,writable:!1,configurable:!1}});class ZekiElement{constructor(e){this.el=e}}Object.defineProperties(ZekiElement.prototype,{one:{value:function one(e){const t=this.el.querySelector(e);return t?t instanceof HTMLTemplateElement?new ZekiFragment(t):new ZekiElement(t):null},writable:!1,enumerable:!0,configurable:!1},all:{value:function all(e){const t=this.el.querySelectorAll(e),n=Array.from(t,(e=>e instanceof HTMLTemplateElement?new ZekiFragment(e):new ZekiElement(e)));return new ZekiCollection(n)},writable:!1,enumerable:!0,configurable:!1},getTag:{value:function getTag(e){const t=this.el.getElementsByTagName(e),n=Array.from(t,(e=>e instanceof HTMLTemplateElement?new ZekiFragment(e):new ZekiElement(e)));return new ZekiCollection(n)},writable:!1,enumerable:!0,configurable:!1},getClass:{value:function getClass(e){const t=this.el.getElementsByClassName(e),n=Array.from(t,(e=>e instanceof HTMLTemplateElement?new ZekiFragment(e):new ZekiElement(e)));return new ZekiCollection(n)},writable:!1,enumerable:!0,configurable:!1},getStyle:{value:function getStyle(e=null){return e?getComputedStyle(this.el)[e]:getComputedStyle(this.el)},writable:!1,enumerable:!0,configurable:!1},getAttr:{value:function getAttr(e){return this.el.getAttribute(e)},writable:!1,enumerable:!0,configurable:!1},setAttr:{value:function setAttr$1(e,t){return this.el.setAttribute(e,t),this},writable:!1,enumerable:!0,configurable:!1},setAttrs:{value:function setAttrs(e){return Object.entries(e).forEach((([e,t])=>this.el.setAttribute(e,t))),this},writable:!1,enumerable:!0,configurable:!1},delAttr:{value:function delAttr$1(e){return this.el.removeAttribute(e),this},writable:!1,enumerable:!0,configurable:!1},remove:{value:function remove$1(){return this.el.remove(),this},writable:!1,enumerable:!0,configurable:!1},addKid:{value:function addKid$1(e){return e instanceof ZekiElement&&(e=e.el),this.el.appendChild(e),this},writable:!1,enumerable:!0,configurable:!1},addKids:{value:function addKids(...e){return e.forEach((e=>{e instanceof ZekiElement&&(e=e.el),this.el.appendChild(e)})),this},writable:!1,enumerable:!0,configurable:!1},delKid:{value:function delKid(e){return e instanceof ZekiElement&&(e=e.el),this.el.removeChild(e),this},writable:!1,enumerable:!0,configurable:!1},delKids:{value:function delKids(e){return e.forEach((e=>{e instanceof ZekiElement&&(e=e.el),this.el.removeChild(e)})),this},writable:!1,enumerable:!0,configurable:!1},before:{value:function before(e,t){return e instanceof ZekiElement&&(e=e.el),t instanceof ZekiElement&&(t=t.el),this.el.insertBefore(e,t),this},writable:!1,enumerable:!0,configurable:!1},addClass:{value:function addClass$1(e){return this.el.classList.add(e),this},writable:!1,enumerable:!0,configurable:!1},delClass:{value:function delClass$1(e){return this.el.classList.remove(e),this},writable:!1,enumerable:!0,configurable:!1},siblings:{value:function siblings$1(){const e=[];let t=this.el.previousSibling;for(;t;)1===t.nodeType&&e.push(new ZekiElement(t)),t=t.previousSibling;e.reverse();let n=this.el.nextSibling;for(;n;)1===n.nodeType&&e.push(new ZekiElement(n)),n=n.nextSibling;return new ZekiCollection(e)},writable:!1,enumerable:!0,configurable:!1},dataBind:{value:function dataBind(e={}){if(Array.isArray(e)||"object"!=typeof e)throw new Error("dataBind: data must be an object.");const t=Array.from(this.el.querySelectorAll("[z-for]")).reverse();t.length>0&&t.forEach((t=>{const[n,r,i]=t.getAttribute("z-for").trim().replace(/\s+/g," ").split(" "),l=e[i];if(!Array.isArray(l))return;t.removeAttribute("z-for");const o=Array.from(t.querySelectorAll("[z-cloak]"));o.length>0&&o.forEach((e=>e.removeAttribute("z-cloak"))),t.outerHTML;let a="";"of"===r?a=l.map((e=>renderTemplate(t.cloneNode(!0),{[n]:e}).innerHTML)).join(""):"in"===r&&(a=l.map(((e,r)=>renderTemplate(t.cloneNode(!0),{[n]:r,[i]:{[r]:l[r]}}).innerHTML)).join("")),t.insertAdjacentHTML("afterend",a),t.remove()}));const n=Array.from(this.el.querySelectorAll("[z-cloak]"));return n.length>0&&n.forEach((e=>e.removeAttribute("z-cloak"))),renderTemplate(this.el,e),this},writable:!1,enumerable:!0,configurable:!1},routerBind:{value:function routerBind({mode:e="hash",routes:t=[]}){let n;switch(t.length||console.warn("routes has not any data."),e){case"hash":n=new HashRouter(this.el,t);break;case"history":n=new HistoryRouter(this.el,t)}return n},writable:!1,enumerable:!0,configurable:!1},on:{value:function on$1(e,t,n=!1){if("function"==typeof t)return this.el.addEventListener(e,t,n),this},writable:!1,enumerable:!0,configurable:!1},off:{value:function off$1(e,t){if("function"==typeof t)return this.el.removeEventListener(e,t),this},writable:!1,enumerable:!0,configurable:!1},click:{value:function click(){return this.el.click(),this},writable:!1,enumerable:!0,configurable:!1},html:{get:function getHTML(){return this.el.innerHTML},set:function setHTML(e){return this.el.innerHTML=e,this},enumerable:!0,configurable:!1},text:{get:function getText(){return this.el.innerText},set:function setText(e){return this.el.innerText=e,this},enumerable:!0,configurable:!1},value:{get:function getValue(){return this.el.value},set:function setValue(e){return this.el.value=e,this},enumerable:!0,configurable:!1},id:{get:function getIdName(){return this.el.id},set:function setIdName(e){return this.el.id=e,this},enumerable:!0,configurable:!1},className:{get:function getClassName(){return this.el.className},set:function setClassName(e){return this.el.className=e,this},enumerable:!0,configurable:!1},disabled:{get:function getDisabled(){return this.el.disabled},set:function setDisabled(e){return this.el.disabled=e,this},enumerable:!0,configurable:!1},type:{get:function getType(){return this.el.type},set:function setType(e){return this.el.type=e,this},enumerable:!0,configurable:!1},src:{get:function getSRC(){return this.el.src},set:function setSRC(e){return this.el.src=e,this},enumerable:!0,configurable:!1},scrollTop:{get:function getScrollTop(){return this.el.scrollTop},set:function setScrollTop(e){return this.el.scrollTop=e,this},enumerable:!0,configurable:!1},onload:{get:function getOnload(){return this.el.onload},set:function setOnload(e){return this.el.onload=e,this},enumerable:!0,configurable:!1},onerror:{get:function getOnerror(){return this.el.onerror},set:function setOnerror(e){return this.el.onerror=e,this},enumerable:!0,configurable:!1},kids:{get:function kids(){const e=this.el.children,t=Array.from(e,(e=>new ZekiElement(e)));return new ZekiCollection(t)},enumerable:!0,configurable:!1},kidNodes:{get:function kidNodes(){const e=this.el.childNodes,t=Array.from(e).filter((e=>1===e.nodeType)).map((e=>new ZekiElement(e)));return new ZekiCollection(t)},enumerable:!0,configurable:!1},firstKid:{get:function firstKid(){return new ZekiElement(this.el.firstChild)},enumerable:!0,configurable:!1},lastKid:{get:function lastKid(){return new ZekiElement(this.el.lastChild)},enumerable:!0,configurable:!1}});class ZekiCollection extends Array{constructor(e=[]){super();for(let t=0;t<e.length;t++)this[t]=e[t]}}Object.defineProperties(ZekiCollection.prototype,{setAttr:{value:function setAttr(e,t){return this.forEach((n=>n instanceof ZekiElement?n.el.setAttribute(e,t):n.setAttribute(e,t))),this},writable:!1,enumerable:!0,configurable:!1},delAttr:{value:function delAttr(e){return this.forEach((t=>t instanceof ZekiElement?t.el.removeAttribute(e):t.removeAttribute(e))),this},writable:!1,enumerable:!0,configurable:!1},addClass:{value:function addClass(e){return this.forEach((t=>t instanceof ZekiElement?t.el.classList.add(e):t.classList.add(e))),this},writable:!1,enumerable:!0,configurable:!1},delClass:{value:function delClass(e){return this.forEach((t=>t instanceof ZekiElement?t.el.classList.remove(e):t.classList.remove(e))),this},writable:!1,enumerable:!0,configurable:!1},addKid:{value:function addKid(e){return e instanceof ZekiElement&&(e=e.el),this.forEach((t=>{let n=e.cloneNode(!0);t instanceof ZekiElement?t.el.appendChild(n):t.appendChild(n)})),this},writable:!1,enumerable:!0,configurable:!1},remove:{value:function remove(){return this.forEach((e=>{e instanceof ZekiElement?e.el.remove():e.remove()})),this},writable:!1,enumerable:!0,configurable:!1},siblings:{value:function siblings(){const e=[],t=this.map((e=>e.el));for(let n=0;n<t.length;n++){let r=t[n].previousSibling;for(;r;)1!==r.nodeType||t.includes(r)||e.push(new ZekiElement(r)),r=r.previousSibling;let i=t[n].nextSibling;for(;i;)1!==i.nodeType||t.includes(i)||e.push(new ZekiElement(i)),i=i.nextSibling}return e.sort(((e,t)=>e.el.compareDocumentPosition(t.el)&Node.DOCUMENT_POSITION_PRECEDING?1:-1)),new ZekiCollection(e)},writable:!1,enumerable:!0,configurable:!1},on:{value:function on(e,t,n=!1){if("function"==typeof t)return this.forEach((r=>{r instanceof ZekiElement?r.el.addEventListener(e,t,n):r.addEventListener(e,t,n)})),this},writable:!1,enumerable:!0,configurable:!1},off:{value:function off(e,t){if("function"==typeof t)return this.forEach((n=>{n instanceof ZekiElement?n.el.removeEventListener(e,t):n.removeEventListener(e,t)})),this},writable:!1,enumerable:!0,configurable:!1},length:{get:function length(){return this.length},enumerable:!0,configurable:!1},[Symbol.iterator]:{value:function values(){let e=0;const t=this;return{next:()=>e<t.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}},writable:!1,enumerable:!1,configurable:!1},[Symbol.toStringTag]:{value:"ZekiCollection",enumerable:!1,writable:!1,configurable:!1}}),Object.freeze(t),function initializeZekiCore(){const e="Copyright Zone",t=e.padStart(29,"-").padEnd(44,"-");console.log(`%c${t}\n\n    Author: Zeki\n    Mail: zekixfly@hotmail.com\n\n    版權聲明:\n    一、本網站的版權屬原作者所有。\n    二、盼望尊重知識產權，如要轉貼複製請註明出處來源。\n    三、出處來源: https://zekixfly.github.io/\n    \n${t}`,"font-size: small; color: brown;"),document.oncontextmenu=()=>!1,document.ondragstart=()=>!1,document.onselectstart=()=>!1,document.addEventListener("DOMContentLoaded",loadZekiImports)}(),"undefined"!=typeof window&&(window.ZekiCore=t,window.zk=t)}();
